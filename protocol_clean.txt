
ОАО  АЗТ

 
ПРОТОКОЛ
обмена данными между системой управления и
топливораздаточной колонкой.
Версия 2.0.
(дополненный)

2003

Данный протокол обмена данными между системой управления и топливораздаточной колонкой является собственностью ОАО АЗТ и применяется во всех топливораздаточных колонках, производимых ОАО АЗТ, управление которыми осуществляется по двухпроводному последовательному интерфейсу RS-485.

( Авторское право 2000 ОАО «Автозаправочная техника».
Все авторские права защищены. Воспроизведение, адаптация или перевод без предварительного письменного разрешения запрещены, за исключением случаев, предусмотренных законами об авторских правах. 

Со всеми вопросами по данному протоколу обращаться в: 

О А О   А З Т
142207 г. Серпухов, Моск. обл., ул. Полевая, 1.

факс :                        (0967) 754692
тел. :     отдел ВЦ - (0967)790023
            E-Mail:   azt @ online . stack . net
Internet:   http://online.stack.net/~azt

Принятые сокращения:
ТРК – топливораздаточная колонка.
СУ – система управления.
БМУ – блок местного управления топливораздаточной колонки.
РК – раздаточный кран топливораздаточной колонки.
НП – нефтепродукт.
ПО – программное обеспечение.

Содержание.

1.  Среда передачи.	3
2. Формат данных.	3
3.  Адресация ТРК.	4
4.  Диапазоны передаваемых и принимаемых частей пакетов.	4
5.  Команды СУ.	5
6.  Статусы ТРК.	5
7.  Описание команд СУ и ответов ТРК.	6
8.  Алгоритм работы ТРК под контролем СУ при задании дозы отпуска с БМУ ТРК.	28

1.  Среда передачи.

              RS-485 полу дуплекс. 
             Скорость обмена данными – 4800 Бод
       Формат слова: стартовый бит
    7 бит данных
    бит контроля четности
    2 стоповых бита.
2. Формат данных.
2.1. Формат пакета запроса СУ.

Вариант 1.

DEL  


 STX, BEL-DC4 
СТАРТОВЫЙ БАЙТ

СЕТЕВОЙ АДРЕС


КОМАНДА


ДАННЫЕ  (не обязательно)


ETX


ETX


CheckSum
-  контрольная сумма


Вариант 2.

DEL  


 STX 
СТАРТОВЫЙ БАЙТ

КОМАНДА


ДАННЫЕ  


ETX


ETX


CheckSum
-  контрольная сумма


 Примечание. 
1.  Каждый байт запроса между стартовым байтом и ETX дополняется комплиментарным байтом (поразрядное инвертирование), а CheckSum вычисляется как ИСКЛЮЧАЮЩЕЕ ИЛИ всех нормальных байт и одного ETX, без учета стартового байта, а также логическое ИЛИ с 0x40.               
2. Тайм – аут ожидания ответа от ТРК – 400 мс, макс.  количество повторных запросов при ошибке передачи – 3.
После истечения тайм – аута ответ ТРК не допускается. Максимальный временной интервал между запросами от СУ не лимитирован.                   	 

2.2. Формат пакета ответа ТРК.
		
DEL  


STX
- стартовый байт

ДАННЫЕ  


ETX


ETX


CheckSum
-  контрольная сумма


или один из коротких ответов :
 - ACK – данные приняты, команда выполнена.
 - CAN – данные приняты правильно, но выполнить команду нет возможности, т. е. от СУ поступила команда , которую в данный момент времени выполнять нельзя.
 - NAK – данные не приняты, т. е. при полностью корректном запросе от СУ принята команда, не входящая в перечень команд СУ (см. п. 5).

Примечание. 
1.  Каждый байт пакета ответа между стартовым байтом и ETX дополняется комплиментарным байтом (поразрядное инвертирование), а CheckSum вычисляется как ИСКЛЮЧАЮЩЕЕ ИЛИ всех нормальных байт и одного ETX, без учета стартового байта, а также логическое ИЛИ с 0x40.               		
2. 	Максимальная длина ответного пакета – 100 байт.			
3. 	DEL (0x7F) – игнорируется при анализе пакета ответа и служит для исключения потерь при переключении преобразователя интерфейса с приема на передачу.					
4. ТРК не должна отвечать на некорректные запросы, т.е. на запросы в которых не соблюдается формат пакета или неправильная контрольная сумма.

 3.  Адресация ТРК.
Первый байт в пакете запроса, следующий за стартовым байтом и лежащий в диапазоне 0x21-0x2F обозначает сетевые адреса 1-15.

Для СУ допускаются стартовые байты 0х2, 0x7–0x14.
В зависимости от стартового байта используется смещение начального адреса:
0х2 (STX) – смещение 0
0х7 (BEL) – смешение 15
0х8  (BS)   – смещение 30
и т.д. 
Таким образом, в контроллере ТРК адрес подсчитывается следующим образом:

смещение + адрес(1..15)

Контроллер ТРК должен обеспечивать возможность БЕЗРАЗРЫВНОЙ адресации всех контролируемых им пистолетов, с возможностью установки ЛЮБОГО начального адреса.

Внимание!
При анализе принимаемого пакета запроса ТРК должна отвечать только на пакеты со стартовым байтом и следующим за ним адресом, соответствующим заданному в контроллере адресу.
Диапазоны передаваемых и принимаемых частей пакетов.

Наименование
Символ
Код

А) Диапазон служебных символов

0x1-0x20

Стартовый байт: 
        Master( СУ )

         Slave ( ТРК )

STX,
BEL-DC4

STX

0x2,
0x7-0x14

0x2

2. Стоповый байт 
ETX
0x3

3.Ответ ТРК – данные приняты,        
команда выполнена
ACK
0x6

4. Ответ ТРК – – данные не приняты, т. е. при полностью корректном запросе от СУ принята команда, не входящая в перечень команд СУ
NAK
0x15

5. Ответ ТРК -  – данные приняты правильно, но выполнить команду нет возможности, т. е. от СУ поступила команда , которую в данный момент времени выполнять нельзя
CAN
0x18

Б) Адреса

0x21-0x2F
(комплиментарные байты – 0x5E-0x50)

В) Команды СУ

0x31-0x5E
(комплиментарные байты – 0x4E-0x21)

Г) Данные

0x30-0x5E
(комплиментарные байты – 0x4F-0x21)

Д) 
DEL
0х7F


Внимание!
Байты служебных символов (STX, BEL-DC4, ETX, ACK, NAK, CAN) и байты комплиментарные им не должны встречаться в поле «ДАННЫЕ» пакета протокола.
Команды СУ.

Наименование команды
Код команды

Запрос статуса ТРК
‘1’ (0x31)

Санкционирование ТРК
‘2’ (0x32)

Сброс ТРК
‘3’ (0x33)

Запрос текущих данных отпуска топлива
‘4’ (0x34)

Запрос полных данных отпуска топлива

‘5’ (0x35)

Запрос показаний суммарников
‘6’ (0x36)

Запрос типа ТРК
‘7’ (0x37)

Подтверждение записи итогов отпуска
‘8’ (0x38)

Запрос номера версии протокола (UINSW)
‘P’ (0x50)

Установка цены за литр
‘Q’ (0x51)

Установка порога отключения клапана снижения
‘R’ (0x52)

Установка дозы отпуска топлива в рублях
‘S’ (0x53)

Установка дозы отпуска топлива в литрах
‘T’ (0x54)

Долив дозы


Безусловный старт раздачи*
‘V’ (0x56)

Задание сетевого номера ТРК (РК)* / чтение сетевого номера и режима работы рукава*
‘]’ (0х5D)

Задание общих параметров / чтение ID-номера устройства*
‘W’ (0x57)

Запрос номера текущей транзакции (UINTR)
‘Y’ (0x59)

Чтение параметров ТРК*
‘N’ (0х4E)

Запись параметров в ТРК*
‘O‘ (0х4F)

Чтение заданной дозы*
‘X’ (0х58)


Примечание.
* Данные команды поддерживаются системами с номером версии протокола – ‘00000002’ и выше (см. п. 7.9).
Важное примечание.
Для всех команд с точно определенной длинной пакета допускается наличие некоторых дополнительных параметров, следующих за основными параметрами в теле пакета. При отсутствии описания этих параметров в данном документе эти параметры необходимо игнорировать.
Статусы ТРК.

Наименование статуса
Код статуса
Возможные изменения статуса ТРК

1. ТРК выключена. РК установлен.
‘0’ (0x30)
1.1. ‘1’ (0x31)  - при снятии РК
1.2. ‘2’ (0x32) –  при получении команды САНКЦИОНИРОВАНИЕ ТРК 

2. ТРК выключена. РК снят.
‘1’ (0x31)
2.1. ‘0’ (0x30)  - при установке РК
2.2. ‘2’ (0x32) – при получении команды САНКЦИОНИРОВАНИЕ ТРК 

3. Прошла команда САНКЦИОНИРОВАНИЕ ТРК от СУ.

‘2’ (0x32)
3.1. ‘3’ (0x33)  - при включении ТРК
3.2. ‘4’ (0x34)+’0’ (0х30) –  при получении команды СБРОС ТРК. Данные отпуска нулевые.

4. ТРК включена. Идет отпуск топлива.
‘3’ (0x33)
4.1. ‘4’ (0x34)+’0’ (0х30) –  при получении команды СБРОС ТРК (данные отпуска не нулевые) или установлен РК или окончена  выдача топлива.

5. ТРК выключена . Отпуск топлива закончен.
     Байт-причина:
5.1. Отпущенная доза меньше или соответствует заданной.
 5.2. Перелив (или *несанкционированный отпуск)
‘4’ (0x34) + байт-причина

‘0’ (0x30)

‘1’ (0x31)
5.1. ‘0’ (0x30)  - при получении команды ПОДТВЕРЖДЕНИЕ ЗАПИСИ ИТОГОВ ОТПУСКА и установленном РК.
5.2. ‘1’ (0x31)  - при получении команды ПОДТВЕРЖДЕНИЕ ЗАПИСИ ИТОГОВ ОТПУСКА и снятом РК

6. ТРК выключена. Задана доза с БМУ **
‘8’ (0x38)
6.1 ‘2’ (0x32) – при получении команды САНКЦИОНИРОВАНИЕ ТРК
6.2. ‘0’ (0x30)  - при получении команды СБРОС ТРК (или отмены установленной дозы с БМУ) и установленном РК.
6.3. ‘1’ (0x31)  - при получении команды СБРОС ТРК (или отмены установленной дозы с БМУ) и снятом РК


Примечание.
*Несанкционированный отпуск возникает при обнаружении отпуска  топлива при отсутствии команды САНКЦИОНИРОВАНИЕ или  при наличии этой команды, но без пуска ТРК клиентом. Также несанкционированным отпуском считается любой повторно зафиксированный отпуск НП после окончания отпуска заданной дозы, поэтому переход ТРК  в статус ‘4’ (0x34)+’1’ (0х31) возможен из любого состояния.
** Данные статусы поддерживаются системами с номером версии протокола – ‘00000002’ и выше (см. п. 7.9).
Описание команд СУ и ответов ТРК.

7.1. Запрос статуса ТРК – ‘1’ (0x31).

Возможные статусы ТРК до запроса:                                                                    все допустимые

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x31
Запрос статуса ТРК

КОМАНДА
0х4Е
Комплиментарный байт

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:        9


Возможные статусы ТРК после запроса:                                                                    не меняются

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX
0x2
Стартовый байт

ДАННЫЕ
0x3Х
Статус ТРК (Х = 0 – 4)

ДАННЫЕ
0х4Х
Комплиментарный байт

ДАННЫЕ
0x3Х
Байт-причина (Х = 0 или 1) – если есть

ДАННЫЕ
0х4Х
Комплиментарный байт

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.2.
Контрольная сумма

Общее количество байт:      7 или 9



7.2. Санкционирование ТРК – ‘2’ (0x32).

Возможные статусы ТРК до запроса:                                                                             ‘0’, ‘1’ или ‘8’

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x32
Санкционирование ТРК

КОМАНДА
0х4D
Комплиментарный байт

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:    9


Возможные статусы ТРК после запроса:                                                                                      ‘2’              

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


ACK или CAN
0x6 или 0х18
Короткий ответ

Общее количество байт:    2


Примечание.
Команда САНКЦИОНИРОВАНИЕ ТРК должна поступать в ТРК только в следующих случаях:
после прохождения команды УСТАНОВКА ДОЗЫ ОТПУСКА., при этом после ответа АСК регистр полных данных отпуска ТРК обнуляется и любой зафиксированный отпуск топлива ведет к инкременту данного регистра вплоть до следующей команды САНКЦИОНИРОВАНИЕ;
после прохождения команды ДОЛИВ ДОЗЫ, при этом не происходит обнуления регистра полных данных отпуска ТРК и любой зафиксированный отпуск топлива ведет к инкременту данного регистра вплоть до следующей команды САНКЦИОНИРОВАНИЕ;
после обнаружения СУ статуса ‘8’ для санкционирования отпуска заданной с БМУ дозы, при этом после ответа АСК регистр полных данных отпуска ТРК обнуляется и любой зафиксированный отпуск топлива ведет к инкременту данного регистра вплоть до следующей команды САНКЦИОНИРОВАНИЕ;

Сброс ТРК – ‘3’ (0x33).

Возможные статусы ТРК до запроса:                                                                          ‘2’ ,‘3’ или ‘8’

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x33
Сброс ТРК

КОМАНДА
0х4С
Комплиментарный байт

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:    9


Возможные статусы ТРК после запроса:                                                      ‘4’ + ‘0’  или  ‘4’+’1’          
									‘1’ или ‘0’
ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


ACK или CAN
0x6 или 0х18 
Короткий ответ

Общее количество байт:    2


Примечание.
При поступлении команды СБРОС ТРК должно произойти выключение ТРК, если она была включена.
Переход в статусы  ‘4’ + ‘0’  или  ‘4’+’1’     осуществляется из статусов   ‘2’ или ‘3’,
Переход в статусы  ‘0’  или  ’1’     осуществляется ТОЛЬКО из статуса   ‘8’ .

Запрос текущих данных  отпуска топлива – ‘4’ (0x34).

Возможные статусы ТРК до запроса:                                                                    все допустимые

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x34
Запрос текущих данных отпуска

КОМАНДА
0х4В
Комплиментарный байт

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:    9


Возможные статусы ТРК после запроса:                                                                    не меняются               

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX
0x2 
Стартовый байт

ДАННЫЕ
0x30
‘0’

ДАННЫЕ
0х4F
Комплиментарный байт

ДАННЫЕ
0x3L
Сотни литров (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L  = F – 6)

ДАННЫЕ
0x3L
Десятки литров (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L  = F – 6)

ДАННЫЕ
0x3L
Единицы литров (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L  = F – 6)

ДАННЫЕ
0x3L
 Десятые доли литра (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L  = F – 6)

ДАННЫЕ
0x3L
Сотые доли литра (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L  = F – 6)

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.2.
Контрольная сумма

Общее количество байт:    17



Запрос полных данных  отпуска топлива  – ‘5’ (0x35).

Возможные статусы ТРК до запроса:                                                                   все допустимые           

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x35
Запрос полных данных отпуска

КОМАНДА
0х4А
Комплиментарный байт

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:    9


Возможные статусы ТРК после запроса:                                                                     не меняются               

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX
0x2 
Стартовый байт

ДАННЫЕ
0x3L
Тысячи или сотни литров (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L  = F – 6)

6 или 8 байт

ДАННЫЕ
0x3L
Сотые доли литров (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L  = F – 6)

ДАННЫЕ
0x3T
Сотни тысяч, десятки тысяч или тысячи рублей стоимости (Т = 0 – 9)*

ДАННЫЕ
0х4Т
Комплиментарный байт

8, 10 или 12 байт

ДАННЫЕ
0x3T
Копейки стоимости (Т = 0 – 9) 

ДАННЫЕ
0х4T
Комплиментарный байт (Т  = F – 6)

ДАННЫЕ
0x3М
Тысячи или десятки рублей цены  (М = 0 – 9) *

ДАННЫЕ
0х4М
Комплиментарный байт (М = F – 6)

4 или 8 байт

ДАННЫЕ
0x3М
Копейки цены (М = 0 – 9) 

ДАННЫЕ
0х4М
Комплиментарный байт (М = F – 6)

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.2.
Контрольная сумма

Общее количество байт:    37, 39 или 45


Примечание.
1. * Количество разрядов L (литры), Т (стоимость) и М (цена) определяется типом ТРК, согласно ее идентификатору (см. п.7.7).
 2. При вычислении стоимости производится округление до целых копеек, причем если дробная часть меньше 0,5 копеек , то она отбрасывается, а если  равна или больше 0,5 копеек , то целое число копеек увеличивается на единицу.

Запрос показаний суммарников  – ‘6’ (0x36).

Возможные статусы ТРК до запроса:                                                                   все допустимые
	       
ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x36
Запрос показаний суммарников

КОМАНДА
0х49
Комплиментарный байт

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:    9


Возможные статусы ТРК после запроса:                                                                    не меняются               

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX
0x2 
Стартовый байт

ДАННЫЕ
0x3L
Старший разряд суммарных литров (L = 0 – 9)*

ДАННЫЕ
0х4L
Комплиментарный байт

min 12 - max 20 байт

ДАННЫЕ
0x3L
Сотые доли суммарных литров (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L  = F – 6)

ДАННЫЕ
0x3T
Старший разряд суммарных рублей (Т = 0 – 9)*

ДАННЫЕ
0х4Т
Комплиментарный байт

min 12 – max 20 байт

ДАННЫЕ
0x3T
Копейки  (Т = 0 – 9) 

ДАННЫЕ
0х4T
Комплиментарный байт (Т  = F – 6)

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.2.
Контрольная сумма

Общее количество байт:    мin37 –max53


Примечание.
1. * Суммарные литры - n-разрядное число, суммарные рубли - n-разрядное число,   где 8 (  n ( 12. (T.е. суммарники по литрам и рублям имеют одинаковую разрядность).
2. При вычислении суммарных рублей производится округление до целых копеек, причем если дробная часть меньше 0,5 копеек , то она отбрасывается, а если  равна или больше 0,5 , то целое число копеек увеличивается на единицу.
3. Для получения корректных данных опрос суммарников рекомендуется производить в статусах ‘0’  или ‘1’.

Запрос типа ТРК  – ‘7’ (0x37).

Таблица соответствия разрядности данных ТРК по запросу полных данных отпуска согласно ее идентификатору.
Идентификатор
Количество разрядов литров, L
Количество разрядов цены, М
Количество разрядов стоимости, Т

‘A’ (0х3А)
6
4
6

‘В’ (0х3В)
6
6
8

‘С’ (0х3С)
6
4
6

‘D’ (0х3D)
6
4
6

‘E’ (0х3E)
6
4
6

‘F’ (0х3F)
6
6
8

‘G’ (0х40)
6
6
8

‘H’ (0x41)*
5
4
7


Примечание.
* Идентификатор может присваиваться контроллерам ТРК с номером версии протокола 00000002 и выше (см. п. 7.9), остальные идентификаторы – контроллерам  ТРК с номером версии протокола 00000001 и выше. 

Возможные статусы ТРК до запроса:                                                                    все допустимые 

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 – F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x37
Запрос типа ТРК

КОМАНДА
0х48
Комплиментарный байт

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:    9

Возможные статусы ТРК после запроса:                                                                    не меняются               

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX
0x2 
Стартовый байт

ДАННЫЕ
0xХХ
Идентификатор (ХХ = 3А – 41)

ДАННЫЕ
0хХХ
Комплиментарный байт (ХХ = 45 – 3E)

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.2.
Контрольная сумма

Общее количество байт:    7



Подтверждение записи итогов отпуска  – ‘8’ (0x38).

Возможные статусы ТРК до запроса:                                                            ‘4’ + ‘0’ или ‘4’ + ‘1’

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x38
Подтверждение записи итогов отпуска

КОМАНДА
0х47
Комплиментарный байт

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:    9


Возможные статусы ТРК после запроса:                                                                         ‘0’ или ‘1’              

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


ACK или CAN
0x6 или 0х18 
Короткий ответ

Общее количество байт:    2



7.9.   Запрос номера версии протокола (UINSW)   –  “P”(0x50). 

Возможные статусы ТРК до запроса:                                                                    все допустимые

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x50
Запрос номера версии протокола

КОМАНДА
0х2F
Комплиментарный байт

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:    9


Возможные статусы ТРК после запроса:                                                                    не меняются               

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX
0x2 
Стартовый байт

ДАННЫЕ
0x3N
Старший разряд номера версии протокола
(N = 0 – 9)

ДАННЫЕ
0х4N
Комплиментарный байт (N  = F – 6)

ДАННЫЕ
0x3N
(N = 0 – 9)

ДАННЫЕ
0х4N
Комплиментарный байт (N  = F – 6)

ДАННЫЕ
0x3N
 (N = 0 – 9) 

ДАННЫЕ
0х4N
Комплиментарный байт (N  = F – 6)

ДАННЫЕ
0x3N
 (N = 0 – 9) 

ДАННЫЕ
0х4N
Комплиментарный байт (N  = F – 6)

ДАННЫЕ
0x3N
 (N = 0 – 9) 

ДАННЫЕ
0х4N
Комплиментарный байт (N  = F – 6)

ДАННЫЕ
0x3N
 (N = 0 – 9) 

СИМВОЛ
КОД
ПРИМЕЧАНИЕ

ДАННЫЕ
0х4N
Комплиментарный байт (N  = F – 6)

ДАННЫЕ
0x3N
 (N = 0 – 9) 

ДАННЫЕ
0х4N
Комплиментарный байт (N  = F – 6)

ДАННЫЕ
0x3N
Младший разряд номера версии протокола (N = 0 – 9) 

ДАННЫЕ
0х4N
Комплиментарный байт (N  = F – 6)

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.2.
Контрольная сумма

Общее количество байт:    21


 Установка цены за литр  – ‘Q’ (0x51) + 4-разрядное число.

Возможные статусы ТРК до запроса:                                                                              ‘0’ или ‘1’

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x51
Установка цены за литр

КОМАНДА
0х2Е
Комплиментарный байт

ДАННЫЕ
0x3М
Десятки рублей цены (М = 0 – 9) 

ДАННЫЕ
0х4М
Комплиментарный байт (М = F – 6)

ДАННЫЕ
0x3М
Рубли цены (М = 0 – 9) 

ДАННЫЕ
0х4М
Комплиментарный байт (М = F – 6)

ДАННЫЕ
0x3М
Десятки копеек цены (М= 0 – 9) 

ДАННЫЕ
0х4М
Комплиментарный байт (М = F – 6)

ДАННЫЕ
0x3М
 Копейки цены (М = 0 – 9) 

ДАННЫЕ
0х4М
Комплиментарный байт (М = F – 6)

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:    17


Возможные статусы ТРК после запроса:                                                                    не меняются                              

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


ACK или CAN
0x6 или 0х18 
Короткий ответ

Общее количество байт:    2

Примечание.
При изменении цены НП данные о предыдущей заправке в контроллере ТРК обнуляются.

 Установка порога отключения клапана снижения  – ‘R’ (0x52) + 3-разрядное число.

Возможные статусы ТРК до запроса:                                                                              ‘0’ или ‘1’

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x52
Установка порога отключения клапана снижения

КОМАНДА
0х2D
Комплиментарный байт

ДАННЫЕ
0x3L
Литры (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L = F – 6)

ДАННЫЕ
0x3L
Десятые доли литра (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L = F – 6)

ДАННЫЕ
0x3L
Сотые доли литра (L= 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L  = F – 6)

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:    15


Возможные статусы ТРК после запроса:                                                                    не меняются 

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


ACK или CAN
0x6 или 0х18 
Короткий ответ

Общее количество байт:    2



 Установка дозы отпуска топлива в рублях  – ‘S’ (0x53) + 6-разрядное число.

Возможные статусы ТРК до запроса:                                                                              ‘0’ или ‘1’

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x53
Установка дозы отпуска топлива в рублях

КОМАНДА
0х2С
Комплиментарный байт

ДАННЫЕ
0x3Т
Тысячи рублей  (Т = 0 – 9) 

ДАННЫЕ
0х4Т
Комплиментарный байт (Т = F – 6)

ДАННЫЕ
0x3Т
Сотни рублей (Т = 0 – 9) 

ДАННЫЕ
0х4Т
Комплиментарный байт (Т = F – 6)

ДАННЫЕ
0x3Т
Десятки  рублей (Т= 0 – 9) 

ДАННЫЕ
0х4Т
Комплиментарный байт (Т = F – 6)

ДАННЫЕ
0x3Т
Рубли (Т = 0 – 9) 

ДАННЫЕ
0х4Т
Комплиментарный байт (Т = F – 6)

ДАННЫЕ
0x3Т
Десятки  копеек (Т= 0 – 9) 

ДАННЫЕ
0х4Т
Комплиментарный байт (Т = F – 6)

ДАННЫЕ
0x3Т
Копейки (Т = 0 – 9) 

ДАННЫЕ
0х4Т
Комплиментарный байт (Т = F – 6)

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:    21

Возможные статусы ТРК после запроса:                                                                    не меняются                              

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


ACK или CAN
0x6 или 0х18 
Короткий ответ

Общее количество байт:    2


Примечание.
1. При пересчете дозы отпуска топлива в рублях в дозу отпуска топлива в литрах должны соблюдаться следующие правила:
Стоимость дозы топлива, полученная умножением цены за литр на вычисленную дозу топлива в литрах,  не должна превышать заданную дозу отпуска топлива в рублях с учетом округления.
При вычислении дозы отпуска в рублях производится округление до целых копеек, причем если дробная часть меньше 0,5 копеек , то она отбрасывается, а если  равна или больше 0,5 , то целое число копеек увеличивается на единицу.
Пример пересчета дозы отпуска в рублях в дозу отпуска в литрах: цена 1 л топлива –6,70 руб., задана доза отпуска в рублях – 100,03 руб., при этом  доза отпуска в литрах получается –14,93 л.
2. Минимальная доза отпуска топлива в рублях должна быть не меньше стоимости минимальной дозы в литрах (параметр "Минимальная доза отпуска", п. 7.21).

 Установка дозы отпуска топлива в литрах  – ‘T’ (0x54) + 5-разрядное число в сотых долях литра.

Возможные статусы ТРК до запроса:                                                                               ‘0’ или ‘1’

Вариант 1 – разрешен к применению в системах с номером версии протокола 00000001 и выше (см. п. 7.9).

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x54
Установка дозы отпуска топлива в литрах

КОМАНДА
0х2B
Комплиментарный байт

ДАННЫЕ
0x3L
Сотни литров  (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L = F – 6)

ДАННЫЕ
0x3L
Десятки литров (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L = F – 6)

ДАННЫЕ
0x3L
Единицы литров (L= 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L = F – 6)

ДАННЫЕ
0x3L
Десятые доли литра (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L = F – 6)

ДАННЫЕ
0x3L
Сотые доли литра (L= 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L = F – 6)

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:   19



Вариант 2 – разрешен к применению в системах с номером версии протокола 00000002 и выше (см. п. 7.9) и имеет дополнительное поле, наличие которого означает режим отпуска «до полного бака».

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x54
Установка дозы отпуска топлива в литрах

СИМВОЛ
КОД
ПРИМЕЧАНИЕ

КОМАНДА
0х2B
Комплиментарный байт

ДАННЫЕ
0x3L
Сотни литров  (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L = F – 6)

ДАННЫЕ
0x3L
Десятки литров (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L = F – 6)

ДАННЫЕ
0x3L
Единицы литров (L= 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L = F – 6)

ДАННЫЕ
0x3L
Десятые доли литра (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L = F – 6)

ДАННЫЕ
0x3L
Сотые доли литра (L= 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L = F – 6)

ДАННЫЕ
0x31
Признак режима «до полного бака»

ДАННЫЕ
0х4Е
Комплиментарный байт

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:   21


Возможные статусы ТРК после запроса:                                                                    не меняются                              

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


ACK или CAN
0x6 или 0х18 
Короткий ответ

Общее количество байт:    2



Вариант 3 – разрешен к применению в системах с номером версии протокола 00000002 и выше (см. п. 7.9) и имеет второе дополнительное поле, наличие которого означает отпуск в режиме юстировки. Поле используется только в режиме работы с ТРК НАРА6000. Значение '1' соответствует юстировке первой гидравлической ветви, значение '2' – юстировке второй гидравлической ветви.

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x54
Установка дозы отпуска топлива в литрах

КОМАНДА
0х2B
Комплиментарный байт

ДАННЫЕ
0x3L
Сотни литров  (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L = F – 6)

ДАННЫЕ
0x3L
Десятки литров (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L = F – 6)

ДАННЫЕ
0x3L
Единицы литров (L= 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L = F – 6)

ДАННЫЕ
0x3L
Десятые доли литра (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L = F – 6)

ДАННЫЕ
0x3L
Сотые доли литра (L= 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L = F – 6)

ДАННЫЕ
0x31
Признак режима «до полного бака»

ДАННЫЕ
0х4Е
Комплиментарный байт

ДАННЫЕ
0x3U
Признак режима юстировки (U = 1 или 2)

ДАННЫЕ
0х4U
Комплиментарный байт (U = E или D)

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:   23


Примечание.
Минимальная допустимая доза выдачи зависит от значения параметра "Минимальная доза отпуска" (см. п. 7.21).
Максимально допустимая доза выдачи – 990,00 литров или доза, стоимость которой не превышает 9999,99 рублей при Т = 6 (99999,99 рублей при Т = 7; 999999,99 рублей при Т = 8), где Т – количество разрядов стоимости.

 
 Долив дозы  – ‘U’ (0x55).

Возможные статусы ТРК до запроса:                                                                                  ‘0’ + ‘1’

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x55
Долив дозы

КОМАНДА
0х2А
Комплиментарный байт

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:   9


Возможные статусы ТРК после запроса:                                                                    не меняются

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


ACK или CAN
0x6 или 0х18 
Короткий ответ

Общее количество байт:    2


Примечание.
После команды ДОЛИВ ДОЗЫ должна поступать команда САНКЦИОНИРОВАНИЕ ТРК.

Команда "Безусловный старт раздачи" – ‘V’ (0x56).

Возможные статусы ТРК до запроса:                                                                                          ‘2’

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплементарный байт (р = Е – 0) 

КОМАНДА
0x56
Безусловный старт раздачи

КОМАНДА
0х29
Комплиментарный байт

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:    9


Возможные статусы ТРК после запроса:                                                                                      ‘3’
ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


ACK или CAN
0x6 или 0х18
Короткий ответ

Общее количество байт:    2


Команда вызывает пуск колонки НЕЗАВИСИМО от положения раздаточного крана.
В остальном эффект от команды полностью аналогичен пуску ТРК при снятии крана (нажатии кнопки ПУСК/СТОП).

 Задание сетевого номера ТРК (РК) ‘]’ (0x5D).

Возможные статусы ТРК до запроса:                                    			    ‘0’ или ‘1’

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX 
0x2


КОМАНДА
0x5D
Задание сетевого номера ТРК (РК)

КОМАНДА
0х22
Комплиментарный байт

ДАННЫЕ
0x3Q
ID-номер, старший разряд (Q=0–9)

ДАННЫЕ
0х4Q
Комплиментарный байт  (Q = F – 6) 

ДАННЫЕ
0x3Q
ID-номер, (Q=0–9)

ДАННЫЕ
0х4Q
Комплиментарный байт  (Q = F – 6) 

ДАННЫЕ
0x3Q
ID-номер, (Q=0–9)

ДАННЫЕ
0х4Q
Комплиментарный байт  (Q = F – 6) 

ДАННЫЕ
0x3Q
ID-номер, (Q=0–9)

ДАННЫЕ
0х4Q
Комплиментарный байт  (Q = F – 6) 

ДАННЫЕ
0x3Q
ID-номер, младший разряд (Q=0–9)

ДАННЫЕ
0х4Q
Комплиментарный байт  (Q = F – 6) 

ДАННЫЕ
0x3N
Сетевой номер, сотни (N=0–9)

ДАННЫЕ
0х4N
Комплиментарный байт  (N = F – 6) 

ДАННЫЕ
0x3N
Сетевой номер, десятки (N=0–9)

ДАННЫЕ
0х4N
Комплиментарный байт  (N = F – 6) 

ДАННЫЕ
0x3N
Сетевой номер, единицы (N=0–9)

ДАННЫЕ
0х4N
Комплиментарный байт  (N = F – 6) 

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:   23


Возможные статусы ТРК после запроса:                                                                    не меняются             

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


ACK или CAN
0x6 или 0х18 
Короткий ответ

Общее количество байт:    2


Примечание.
Данная команда поддерживается системами с номером версии протокола – ‘00000002’ и выше (см. п. 7.9).
ID – номер (5-разрядное число) – это индивидуальный, неизменяемый номер контроллера ТРК или РК ( при управлении контроллером несколькими РК), записываемый в память контроллера на предприятии- изготовителе, посредством которого ТРК (РК) присваивается сетевой номер на АЗС.

 Чтение сетевого номера и режима работы рукава.

Команда применяется для определения сетевого номера и режима работы рукава по его ID-номеру. Команда используется для выяснения сетевой конфигурации всех устройств.
Команда представляет собой операцию "Задание сетевого номера ТРК", в которой сетевой номер равен нулю.
Возможные статусы ТРК до запроса:                                    			    ‘0’ или ‘1’

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX 
0x2


КОМАНДА
0x5D
Задание сетевого номера ТРК (РК)

КОМАНДА
0х22
Комплиментарный байт

ДАННЫЕ
0x3Q
ID-номер, старший разряд (Q=0–9)

ДАННЫЕ
0х4Q
Комплиментарный байт  (Q = F – 6) 

ДАННЫЕ
0x3Q
ID-номер, (Q=0–9)

ДАННЫЕ
0х4Q
Комплиментарный байт  (Q = F – 6) 

ДАННЫЕ
0x3Q
ID-номер, (Q=0–9)

ДАННЫЕ
0х4Q
Комплиментарный байт  (Q = F – 6) 

ДАННЫЕ
0x3Q
ID-номер, (Q=0–9)

ДАННЫЕ
0х4Q
Комплиментарный байт  (Q = F – 6) 

ДАННЫЕ
0x3Q
ID-номер, младший разряд (Q=0–9)

ДАННЫЕ
0х4Q
Комплиментарный байт  (Q = F – 6) 

ДАННЫЕ
0x30
'0'

ДАННЫЕ
0х4F
Комплиментарный байт 

ДАННЫЕ
0x30
'0'

ДАННЫЕ
0х4F
Комплиментарный байт 

ДАННЫЕ
0x30
'0'

ДАННЫЕ
0х4F
Комплиментарный байт 

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:   23


Возможные статусы ТРК после запроса:                                                                    не меняются             

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX 
0x2


ДАННЫЕ
0x3N
Сетевой номер, сотни (N=0–9)

ДАННЫЕ
0х4N
Комплиментарный байт  (N = F – 6) 

ДАННЫЕ
0x3N
Сетевой номер, десятки (N=0–9)

ДАННЫЕ
0х4N
Комплиментарный байт  (N = F – 6) 

ДАННЫЕ
0x3N
Сетевой номер, единицы (N=0–9)

ДАННЫЕ
0х4N
Комплиментарный байт  (N = F – 6) 

ДАННЫЕ
0x3Q
Режим работы РК (Q=0–3)

ДАННЫЕ
0х4Q
Комплиментарный байт  (Q = F – С) 

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:   13


Если ТРК находится в недопустимом для данной команды статусе, используется короткий ответ:

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


CAN
0х18
Короткий ответ

Общее количество байт:    2


 Задание общих параметров  ‘W’ (0x57) + 2 одноразрядных числа.

Широковещательная команда, принимается одновременно всеми ТРК на линии.
Возможные статусы ТРК до запроса:                                    определяются номером параметра
ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX 
0x2


КОМАНДА
0x57
Задание общих параметров

КОМАНДА
0х28
Комплиментарный байт

ДАННЫЕ
0x3Х
Номер параметра  (Х = 0 - F)

ДАННЫЕ
0х4Х
Комплиментарный байт  (Х = F – 0) 

ДАННЫЕ
0x3Х
Значение параметра (Х = 0 - F)

ДАННЫЕ
0х4Х
Комплиментарный байт (Х = F – 0)

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:   11


Возможные статусы ТРК после запроса:                                                                    не меняются             

ОТВЕТА НЕТ.

Перечень общих параметров и их значений.

Номер параметра
Значение параметра
Возможные статусы ТРК***


‘0’0x30) – Подсветка
‘0’(0x30) – выкл.
‘1’(0x31) – вкл.
все допустимые


'1'(0x31) – Отображение ID-номера и сетевого адреса на табло ТРК*
‘0’(0x30) – выкл.
‘1’(0x31– вкл.
‘?’(0x3F) – чтение ID-номера (см. п. 7.19)
'0' или '1'


'2'(0x32) – Тест индикации ТРК*
‘0’(0x30)  – выкл.
‘1’(0x31 – вкл.
'0' или '1'


'3'(0x33) – Отображение суммарного счетчика на табло ТРК*
‘0’(0x30)  – выкл.
‘1’(0x31)– вкл.
'0' или '1'


'4'(0x34) – Общий сброс всех ТРК*, **
‘0’(0x30)
 ‘2’, ‘3’ или ‘8’


Примечание.
* Данные параметры поддерживаются в системах с номером версии протокола 00000002 и выше (см. п. 7.9).
	        **  - по своему действию команда польностью аналогична  команде СБРОС ТРК.

	       *** - при несоответствии статуса ТРК допустимому статусу для данной команды команда просто игнорируется данной ТРК, никакого ответа на команду не следует.

 Чтение ID-номера устройства

Команда применяется для определения ID-номера устройства в тех случаях, когда вывод информации на табло устройства невозможен. При выполнении команды на линии должно присутствовать только одно устройство.
Команда использует операцию "Задание общих параметров", аналогичную применяемой для отображения ID-номера на табло ТРК, но с параметром '?'.

Возможные статусы ТРК до запроса:                                    			    ‘0’ или ‘1’
	
ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX 
0x2


КОМАНДА
0x57
Задание общих параметров

КОМАНДА
0х28
Комплиментарный байт

ДАННЫЕ
0x31
'1'

ДАННЫЕ
0х4E
Комплиментарный байт

ДАННЫЕ
0x3F
'?'

ДАННЫЕ
0х40
Комплиментарный байт

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:   11


Возможные статусы ТРК после запроса:                                                                    не меняются             

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX 
0x2


ДАННЫЕ
0x3Q
ID-номер, старший разряд (Q=0–9)

ДАННЫЕ
0х4Q
Комплиментарный байт  (Q = F – 6) 

ДАННЫЕ
0x3Q
ID-номер, (Q=0–9)

ДАННЫЕ
0х4Q
Комплиментарный байт  (Q = F – 6) 

ДАННЫЕ
0x3Q
ID-номер, (Q=0–9)

ДАННЫЕ
0х4Q
Комплиментарный байт  (Q = F – 6) 

ДАННЫЕ
0x3Q
ID-номер, (Q=0–9)

ДАННЫЕ
0х4Q
Комплиментарный байт  (Q = F – 6) 

ДАННЫЕ
0x3Q
ID-номер, младший разряд (Q=0–9)

ДАННЫЕ
0х4Q
Комплиментарный байт  (Q = F – 6) 

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:   15



 Запрос номера текущей транзакции (UINTR)   – ‘Y’(0x59).

Номер транзакции (8 – разрядное число) формируется последовательным инкрементом на  1 не сбрасываемого счетчика транзакций  в ТРК. Инкремент счетчика происходит в момент подтверждения ТРК получения  команды САНКЦИОНИРОВАНИЕ ТРК или УСТАНОВКА ЦЕНЫ ЗА ЛИТР НП.
Данная команда служит для ведения точного учета отпуска ТРК НП. Использование или не использование данной команды определяется разработчиком СУ.

Возможные статусы ТРК до запроса:                                                                    все допустимые

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x59
Запрос номера транзакции

КОМАНДА
0х26
Комплиментарный байт

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:    9


Возможные статусы ТРК после запроса:                                                                    не меняются               

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX
0x2 
Стартовый байт

ДАННЫЕ
0x3N
Старший разряд номера транзакции
(N = 0 – 9)

ДАННЫЕ
0х4N
Комплиментарный байт (N  = F – 6)

ДАННЫЕ
0x3N
(N = 0 – 9)

ДАННЫЕ
0х4N
Комплиментарный байт (N  = F – 6)

ДАННЫЕ
0x3N
 (N = 0 – 9) 

ДАННЫЕ
0х4N
Комплиментарный байт (N  = F – 6)

ДАННЫЕ
0x3N
 (N = 0 – 9) 

ДАННЫЕ
0х4N
Комплиментарный байт (N  = F – 6)

ДАННЫЕ
0x3N
 (N = 0 – 9) 

ДАННЫЕ
0х4N
Комплиментарный байт (N  = F – 6)

ДАННЫЕ
0x3N
 (N = 0 – 9) 

СИМВОЛ
КОД
ПРИМЕЧАНИЕ

ДАННЫЕ
0х4N
Комплиментарный байт (N  = F – 6)

ДАННЫЕ
0x3N
 (N = 0 – 9) 

ДАННЫЕ
0х4N
Комплиментарный байт (N  = F – 6)

ДАННЫЕ
0x3N
Младший разряд номера транзакции (N = 0 – 9) 

ДАННЫЕ
0х4N
Комплиментарный байт (N  = F – 6)

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.2.
Контрольная сумма

Общее количество байт:    21


Примечание.
Предлагается  следующий алгоритм использования данной команды:
Запрос статуса ТРК ( статус ‘0(1)’(  ( задание дозы (долив) ( санкционирование ( статус ‘2’( ( отпуск ( статус ‘3’( ( окончание отпуска  ( статус ‘4’( (  запрос данных полного отпуска  ( запрос номера транзакции ( подтверждение записи итогов отпуска  ( статус ‘0(1)’(.

Запрос статуса ТРК ( статус ‘0(1)’( ( установка цены за литр ( запрос номера транзакции.

 Чтение параметров ТРК   – ‘N’ (0х4E).

Вариант 1  - чтение кодов параметров, поддерживаемых  ТРК.

Возможные статусы ТРК до запроса:                                                                   все допустимые

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x4E
Чтение параметров

КОМАНДА
0х31
Комплиментарный байт

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:    9


Возможные статусы ТРК после запроса:                                                                    не меняются               

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX
0x2 
Стартовый байт

ДАННЫЕ
0x30-0x4F
Код параметра  

ДАННЫЕ
0х4F- 0x30
Комплиментарный байт  

min 2 – max 2m байт, где m – количество поддерживаемых параметров

далее идут все поддерживаемые ТРК параметры, в представленном ниже формате

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.2.
Контрольная сумма

Общее количество байт:    min 7 – max 100


Примечание. 
В случае, если ТРК не поддерживает ни одного параметра, используется короткий ответ:

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


NAK
0х15
Короткий ответ

Общее количество байт:    2



Вариант 2 – чтение значений конкретных параметров ТРК.

Возможные статусы ТРК до запроса:                                                                  все допустимые

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x4E
Чтение параметров

КОМАНДА
0х31
Комплиментарный байт

ДАННЫЕ
0x30-0x4F
Код параметра 

ДАННЫЕ
0х4F- 0x30
Комплиментарный байт  

min 2 – max (2n) байт, где n – общее количество параметров

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:    2n+9


Возможные статусы ТРК после запроса:                                                                    не меняются               

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX
0x2 
Стартовый байт

ДАННЫЕ
0x30-0x4F
Код параметра  

ДАННЫЕ
0х4F- 0x30
Комплиментарный байт 

ДАННЫЕ
0x3Х
Значение параметра, старший разряд (Х = 0 - F)

ДАННЫЕ
0х4Х
Комплиментарный байт (Х = F – 0)

min 0 – max (2m-2) байт, где m –количество разрядов данного параметра

далее идут все запрашиваемые СУ и поддерживаемые ТРК параметры, в представленном ниже формате

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.2.
Контрольная сумма

Общее количество байт: min (2m+7) – max 100


Примечание. 
1. В случае, если ТРК не поддерживает ни одного из запрашиваемых параметров, используется короткий ответ:
ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


NAK
0х15
Короткий ответ

Общее количество байт:    2


2. При запросе СУ значения параметра, не поддерживаемого ТРК, в ответе ТРК данный параметр просто игнорируется и не включается в данные ответа.

3. При превышении в сформированном ответном пакете максимально допустимого для данного протокола числа байт в пакете пакет не передается и следует короткий ответ:

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


CAN
0х18
Короткий ответ

Общее количество байт:    2


Для предотвращения подобных ситуаций при запросе большого числа параметров необходимо пользоваться несколькими командами чтения параметров с разными номерами параметров.

Перечень  параметров и их значений.

Наименование параметра
Код параметра
Количес-тво раз-рядов в значении параметра 
Значение параметра
Примечание

1
2
3
4
5

1. Режим работы ТРК: выбор способа управления 
‘0’(0x30)
1
‘0’(0x30) – импульсная система команд 
‘1’(0x31) – последователь-ный интерфейс – данный протокол обмена данными
‘2’(0x32) – последователь-ный интерфейс – другой протокол обмена данными


2. Режим работы ТРК: выбор способа задания дозы
‘1’(0x31)
1
‘0’(0x30) – задание дозы разрешено только от СУ
‘1’(0x31) – задание дозы разрешено от БМУ под контролем СУ


3. Режим работы РК
‘2’(0x32)
1
‘0’(0x30) – откл.
‘1’(0x31) – левая сторона
‘2’(0x32) – правая сторона
‘3’(0x33) – специальный режим
Используется при упра-влении контроллером ТРК 2-мя РК и более

4. Тип датчика расхода топлива
 ‘3’(0x33)  
1
‘0’(0x30) –одноканальный
‘1’(0x31) – двухканальный
‘2’(0x32) –одноканальный на второй вход
‘3’(0x33) – двухканальный без диагностики
*

5. Дискретность датчика расхода топлива (импульсы/л)
‘4’(0x34)  
3
1 разряд –сотни
          ‘0’(0x30)  - ‘9’(0x39)  
2 разряд –десятки
          ‘0’(0x30)  - ‘9’(0x39)  
3 разряд –единицы
          ‘0’(0x30)  - ‘9’(0x39)  
Например. 
10 мл датчик расхода – 100 импульсов/л
1 разряд – ‘1’(0x31)  
2 разряд – ‘0’(0x30)  
3 разряд – ‘0’(0x30)  

6. Минимальная длительность счетных импульсов (дискретность – 0,1 мс)
‘5’(0x35) 
3
1 разряд –десятки мс
          ‘0’(0x30)  - ‘9’(0x39)  
2 разряд –единицы мс
          ‘0’(0x30)  - ‘9’(0x39)  
3 разряд –десятые доли мс
          ‘0’(0x30)  - ‘9’(0x39)  


7. Тип РК
‘6’(0x36) 
1
‘0’(0x30) – тип 1
‘1’(0x31) – тип 2
‘2’(0x32) – тип 3
‘3’(0x33) – тип 4
****

8. Время, в течении которого контроллер ТРК не реагирует на изменение положения датчика РК, после последнего изменения (дискретность – 0,1 с)
‘7’(0x37)
2
1 разряд –единицы секунд
          ‘0’(0x30)  - ‘9’(0x39)  
2 разряд –десятые доли секунды‘0’(0x30)-  
                           ‘9’(0x39)  


9. Тип клапана снижения расхода топлива
‘8’(0x38)
1
‘0’0x30) – клапан двой-ного действия (КДД)
‘1’0x31) – импульсный клапан (КСП)
**

10. Момент включения клапана снижения  после включения ТРК (дискретность – 0,01 л)
‘9’(0x39)
3
1 разряд –единицы литров
          ‘0’(0x30)  - ‘2’(0x32)  
2 разряд –десятые доли литра ‘0’(0x30)  - ‘9’(0x39)  
3 разряд –сотые доли лит-ра ‘0’(0x30)  - ‘9’(0x39)  
Может изменяться в пределах от 0,00 до 2,00 литров

11. Порог отключения клапана снижения  (дискретность – 0,01 л)
‘:’(0x3А)
3
1 разряд –единицы литров
          ‘0’(0x30)  - ‘2’(0x32)  
2 разряд –десятые доли литра ‘0’(0x30)  - ‘9’(0x39)  
3 разряд –сотые доли литра ‘0’(0x30)  - ‘9’(0x39)  
Может изменяться в пределах от 0,00 до 3,00 литров

12. Время работы насоса при отсутствии импульсов от датчика расход (дискретность – 1 с)
‘;’(0x3В)
3
1 разряд –сотни секунд
         ‘0’(0x30)  - ‘1’(0x31)  
2 разряд –десятки секунд
          ‘0’(0x30)  - ‘9’(0x39)  
3 разряд –единицы секунд
          ‘0’(0x30)  - ‘9’(0x39)
Может изменяться в пределах от 3 до 180 с

13. Время работы насоса при отсутствии импульсов от датчика расход в режиме «до полного бака» (дискретность – 1 с)
‘<’(0x3С)
2
1 разряд –десятки секунд
          ‘0’(0x30)  - ‘3’(0x33)  
2 разряд –единицы секунд
          ‘0’(0x30)  - ‘9’(0x39)  
Может изменяться в пределах от 3 до 30 с

14. Время до включения двигателя после снятия РК (дискретность –1 с)
‘=’(0x3D)
2
1 разряд –десятки секунд
          ‘0’(0x30)  - ‘2’(0x32)  
2 разряд –единицы секунд
          ‘0’(0x30)  - ‘9’(0x39)  
Может изменяться в пределах от 0 до 20 с

15. Условие включения двигателя ТРК
‘>’(0x3Е)
1
‘0’(0x30) – получение команды «Санкциониро-вание ТРК», снятие РК
‘1’(0x31) – снятие РК, получение команды «Санкционирование ТРК»


16. Количество импульсов от датчика расхода, после которых начнется отображение информации об отпуске топлива на индикаторе контроллера ТРК (дискретность –1 импульс)
‘?’(0x3F)
2
1 разряд –десятки импульсов
          ‘0’(0x30)  - ‘5’(0x35)  
2 разряд –единицы импульсов
          ‘0’(0x30)  - ‘9’(0x39)  
Может изменяться в пределах от 0 до 50 импульсов

17. Количество некорректных импульсов от датчика расхода, приводящих к отключению двигателя ТРК
‘@’(0x40)
2
1 разряд –десятки импульсов
          ‘0’(0x30)  - ‘1’(0x31)  
2 разряд –единицы импульсов
          ‘0’(0x30)  - ‘9’(0x39)  
Может изменяться в пределах от 3 до 15 импульсов.
Импульсы должны идти непрерывно. 

18. Величина буфера обратного вращения датчика расхода (дискретность –1 импульс)
‘А’(0x41)
2
1 разряд –десятки импульсов
          ‘0’(0x30)  - ‘2’(0x32)  
2 разряд –единицы импульсов
          ‘0’(0x30)  - ‘9’(0x39)  
Может изменяться в пределах от 3 до 25 импульсов
***

19. Чтение аварийного суммарного счетчика (дискретность – 0,01 л)
‘В’(0x42)
5
1 разряд –сотни литров
          ‘0’(0x30)  - ‘9’(0x39)  
2 разряд –десятки литров    
          ‘0’(0x30)  - ‘9’(0x39)  
3 разряд –единицы литров
          ‘0’(0x30)  - ‘2’(0x32)  
4 разряд –десятые доли литра ‘0’(0x30)  - ‘9’(0x39)  
5 разряд –сотые доли лит-ра       ‘0’(0x30)  - ‘9’(0x39)  
Аварийный суммарный счетчик фиксирует суммарное количество аварийно отпущенного топлива с момента его последнего обнуления

20. Номер версии ПО контроллера ТРК
‘С’(0x43)
3
1 разряд –сотни 
          ‘0’(0x30)  - ‘9’(0x39)  
2 разряд –десятки    
          ‘0’(0x30)  - ‘9’(0x39)  
3 разряд –единицы 
          ‘0’(0x30)  - ‘2’(0x32)  


21. Время ожидания остановки насосного агрегата (дискретность – 0,1 с)

‘D’(0x44) 
3
1 разряд – десятки секунд
         ‘0’(0x30)  - ‘1’(0x31)  
2 разряд – единицы секунд
          ‘0’(0x30)  - ‘9’(0x39)  
3 разряд – десятые доли секунды
          ‘0’(0x30)  - ‘9’(0x39)
Может изменяться в пределах от 0,0 до 10,0 с

22. Время задержки прямого пуска (дискретность – 1 с)

‘E’(0x45) 
2
1 разряд – десятки секунд
         ‘0’(0x30)  - ‘2’(0x31)  
2 разряд – единицы секунд
          ‘0’(0x30)  - ‘9’(0x39)  
Может изменяться в пределах от 0 до 20 с
*****

23. Количество цифр после запятой при отображении суммы к оплате

‘F’(0x46) 
1
‘0’(0x30) – отображение только целой части
‘1’(0x31) – отображение десятых долей
‘2’(0x32) – отображение сотых долей
Используется только при работе с табло ограниченной разрядности (5 знаков в строке)

24. Минимальная доза отпуска, л (дискретность – 0,01 л)

‘G’(0x47) 
3
1 разряд – единицы литров
         ‘0’(0x30)  - ‘5’(0x35)  
2 разряд – десятые доли литра
          ‘0’(0x30)  - ‘9’(0x39)  
3 разряд – сотые доли литра
          ‘0’(0x30)  - ‘9’(0x39)
Может изменяться в пределах от 0,01 до 5,00 л

25. Производительность гидравлических ветвей, л/мин (дискретность – 1 л/мин)

‘H’(0x48) 
6
1 разряд – сотни литров в минуту, 1-я ветвь
         ‘0’(0x30)  - ‘9’(0x39)  
2 разряд – десятки литров в минуту, 1-я ветвь
         ‘0’(0x30)  - ‘9’(0x39)  
3 разряд – единицы литров в минуту, 1-я ветвь
         ‘0’(0x30)  - ‘9’(0x39)  
4 разряд – сотни литров в минуту, 2-я ветвь
         ‘0’(0x30)  - ‘9’(0x39)  
5 разряд – десятки литров в минуту, 2-я ветвь
         ‘0’(0x30)  - ‘9’(0x39)  
6 разряд – единицы литров в минуту, 2-я ветвь
         ‘0’(0x30)  - ‘9’(0x39) 
Может изменяться в пределах от 0 до 999 л/мин.
Измерение производится только при отпуске на полном расходе. Минимальное количество счетных импульсов – 2, время измерения – не более 30мин.
При невыполнении условий параметр имеет нулевое значение.


Примечание.
* Тип датчика расхода топлива - одноканальный означает, что контроллер ТРК будет анализировать импульсы, приходящие на 1 счетный вход ОУ.
Тип датчика расхода топлива – двухканальный означает, что контроллер ТРК будет анализировать последовательности импульсов, приходящие на счетные входы контроллера и сдвинутые друг относительно друга на 90(. 
Тип датчика расхода топлива - одноканальный на второй вход означает, что контроллер ТРК будет анализировать импульсы, приходящие на 2 счетный вход ОУ.
Тип датчика расхода топлива – "двухканальный без диагностики" аналогичен типу "двухканальный", за исключением того, что в случае пропадания импульсов по одному из каналов датчика и наличии их на другом канале, отсчетное устройство не переходит в состояние ошибки.

**  Клапан двойного действия (КДД) –это клапан, состоящий из клапана снижения расхода и клапана отсечного. При работе ТРК с номинальной производительностью оба клапана включены. При переходе ТРК на сниженную производительность происходит отключение клапана снижения расхода, а при окончании выдачи заданной дозы – отключение клапана отсечного.
Импульсный клапан (КСП) – это клапан снижения расхода, для включения которого необходимо подать импульс в течении 0,3 с напряжением 220 В. После снятия напряжения клапан работает автоматически (примерно в течении 3 с) до окончания выдачи дозы. Данный клапан применяется в ТРК с дискретностью счета –1 импульс/л.
***  Буфер обратного вращения датчика расхода топлива – это буфер, в котором запоминаются импульсы, поступающие на вход контроллера ТРК при обратном вращении датчика расхода. Если количество таких импульсов не превышает заданное значение, то при поступлении импульсов прямого вращения из них вычитается зафиксированное количество импульсов обратного вращения датчика расхода. Если количество импульсов обратного вращения превышает заданное значение, ТРК останавливается и выдается сообщение о неисправности датчика расхода.

**** "ТИП 1". Кнопка расположена под краном ТРК и срабатывает при снятии крана: кран вставлен – контакты кнопки разомкнуты, кран снят – контакты замкнуты. Пуск колонки – при снятии крана (замыкании контактов). Останов колонки – при установке крана в ТРК (размыкании контактов).
"ТИП 2". Кнопка расположена на панели ТРК и срабатывает при нажатии рукой: кнопка отпущена – контакты разомкнуты, кнопка нажата – контакты замкнуты. Пуск колонки – при отпускании кнопки после нажатия (размыкании контактов). Останов колонки – при нажатии кнопки (замыкании контактов).
"ТИП 3". Кнопка расположена под краном ТРК: кран вставлен – контакты кнопки замкнуты, кран снят – контакты разомкнуты. Пуск колонки – при снятии крана (размыкании контактов). Останов колонки – при установке крана в ТРК (замыкании контактов).
"ТИП 4". Кнопка расположена на панели ТРК: кнопка отпущена – контакты замкнуты, кнопка нажата – контакты разомкнуты. Пуск колонки – при отпускании кнопки после нажатия (замыкании контактов). Останов колонки – при нажатии кнопки (размыкании контактов).

***** Функция предназначена для реализации "прямого пуска" – автоматического перевода ТРК в состояние отпуска после предварительной задержки, при условии, что команда санкционирования поступила при снятом раздаточном кране. Нулевое значение параметра означает, что функция отключена.

Общее примечание.
                       Данная команда поддерживаются в системах с номером версии протокола 00000002 и выше (см. п. 7.9).

 Запись параметров в ТРК   – ‘O’(0x4F).

Возможные статусы ТРК до запроса:                                                                             ‘0’ или ‘1’

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x4F
Запись параметров

КОМАНДА
0х30
Комплиментарный байт

ДАННЫЕ
0x30-0x4F 
Номер параметра  (Х = 0 - F)

ДАННЫЕ
0х4F – 0x30
Комплиментарный байт  (Х = F – 0) 

ДАННЫЕ
0x3Х
Значение параметра, старший разряд (Х = 0 - F)

ДАННЫЕ
0х4Х
Комплиментарный байт (Х = F – 0)

min 0 – max (2m-2) байт, где m –количество разрядов данного параметра

min 0 – max байт, где n – общее количество параметров, m –количество разрядов данного параметра

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:    min 13 – max 99


Возможные статусы ТРК после запроса:                                                                    не меняются               

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


ACK или CAN
0x6 или 0х18 
Короткий ответ

Общее количество байт:    2


Примечание.
Перечень всех допустимых параметров, представлен в разделе 7.18.
При записи значения параметра, не поддерживаемого ТРК,  данный параметр игнорируется,
однако при этом ТРК отвечает ACK (или CAN только в случае подачи команды в недопустимом для нее статусе).  
	        3. При превышении в сформированном пакете максимально допустимого для данного протокола числа байт в пакете необходимо уменьшить число передаваемых параметров в одном пакете и использовать несколько команд записи параметров с разными кодами параметров.
4.    Данная команда поддерживаются в системах с номером версии протокола 00000002 и выше (см. п. 7.9).

 Чтение заданной дозы– ‘X’ (0x58).

Возможные статусы ТРК до запроса						‘0’,’1’ или '8’

ЗАПРОС:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX (BEL-DC4)
0x2 (0x7-0x14)


NA
0x2p
Сетевой адрес (p = 1 - F)

NA
0х5р
Комплиментарный байт (р = Е – 0) 

КОМАНДА
0x58
Чтение заданной дозы

КОМАНДА
0х27
Комплиментарный байт

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.1.
Контрольная сумма

Общее количество байт:    9


Возможные статусы ТРК после запроса:                                                                    не меняются               

ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


STX
0x2 
Стартовый байт

ДАННЫЕ
0x30
‘0’

ДАННЫЕ
0х4F
Комплиментарный байт

ДАННЫЕ
0x3L
Сотни литров (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L  = F – 6)

ДАННЫЕ
0x3L
Десятки литров (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L  = F – 6)

ДАННЫЕ
0x3L
Единицы литров (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L  = F – 6)

ДАННЫЕ
0x3L
 Десятые доли литра (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L  = F – 6)

ДАННЫЕ
0x3L
Сотые доли литра (L = 0 – 9) 

ДАННЫЕ
0х4L
Комплиментарный байт (L  = F – 6)

ETX
0х3
Стоповый байт

ETX
0х3
Стоповый байт

CheckSum
См. п. 2.2.
Контрольная сумма

Общее количество байт:    17


Примечание: данная команда используется для контроля заданной дозы после задания дозы командами задания
	дозы, командой долива или заданием дозы с БМУ до выполнения команды САНКЦИОНИРОВАНИЯ. 
	При отсутствии предварительно заданной дозы в статусах ‘0’ или ‘1’ используется короткий ответ на команду:
ОТВЕТ:
СИМВОЛ
КОД
ПРИМЕЧАНИЕ

DEL
0х7F


CAN
0х18 
Короткий ответ

Общее количество байт:    2


8.  Алгоритм работы ТРК под контролем СУ при задании дозы отпуска с БМУ ТРК.
1. Перевод ТРК в данный режим допустим ТОЛЬКО при статусе ТРК ‘0’  или ‘1’.
2. При задании дозы отпуска с БМУ ТРК устанавливает статус ‘8’. В  ответ СУ отсылает на ТРК команду  ЧТЕНИЕ ЗАДАННОЙ ДОЗЫ, на которую ТРК отвечает заданной дозой. После этого СУ подтверждает получение данных командой САНКЦИОНИРОВАНИЕ, после чего ТРК готова к отпуску заданной дозы.
3. При работе ТРК в режиме автоматической  заправки до полного бака статус ‘8’ возникает при снятии РК ТРК, при этом на команду ЧТЕНИЕ ЗАДАННОЙ ДОЗЫ  ТРК отвечает  – 999 л.

